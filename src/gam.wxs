<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi" >
  <Product
      Id="*"
      Name="GAMADV-XTD3"
      Language="1033"
      Version="$(env.GAMVERSION)"
      Manufacturer="Ross Scroggs - ross.scroggs@gmail.com"
      UpgradeCode="D86B52B2-EFE9-4F9D-8BA3-9D84B9B2D319">
    <Package
        InstallerVersion="200" Compressed="yes" InstallScope="perMachine" />

    <MajorUpgrade
        DowngradeErrorMessage=
            "A newer version of [ProductName] is already installed."
        Schedule="afterInstallExecute" />
    <MediaTemplate EmbedCab="yes" />

    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLFOLDER" />
    <WixVariable Id="WixUILicenseRtf" Value="LICENSE.rtf" />
    <UIRef Id="WixUI_InstallDir" />

    <Feature
        Id="gam"
        Title="GAMADV-XTD3"
        Level="1">
      <ComponentGroupRef Id="ProductComponents" />
    </Feature>
  </Product>

  <Fragment>
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ROOTDRIVE">
          <Directory Id="INSTALLFOLDER" Name="GAMADV-XTD3" />
        </Directory>
    </Directory>
  </Fragment>

  <Fragment>
    <!-- Group of components that are our main application items -->
    <ComponentGroup
        Id="ProductComponents"
        Directory="INSTALLFOLDER"
        Source="gamadv-xtd3-64">
      <Component Id="gam_exe" Guid="d046ea24-c9f8-40ca-84db-70b0119933ff">
        <File Name="gam.exe" KeyPath="yes" />
        <Environment Id="PATH" Name="PATH" Value="[INSTALLFOLDER]" Permanent="yes" Part="last" Action="set" System="yes" />
      </Component>
      <Component Id="license" Guid="c76864c5-d005-44d5-bb7c-a27e5923792d">
        <File Name="LICENSE" KeyPath="yes" />
      </Component>
      <Component Id="whatsnew_txt" Guid="64c29297-d693-4340-aca6-7185cac9e9fa">
        <File Name="whatsnew.txt" KeyPath="yes" />
      </Component>
      <Component Id="gam_setup_bat" Guid="5e6bbacb-d86f-4d80-a10b-89b81ee63fcb">
        <File Name="gam-setup.bat" KeyPath="yes" />
      </Component>
      <Component Id="GamCommands_txt" Guid="a2dca862-b222-469e-a637-95ea2a1c53e7">
        <File Name="GamCommands.txt" KeyPath="yes" />
      </Component>
      <Component Id="GamConfig_txt" Guid="5d264757-2598-4104-9829-dd50d5b98ef7">
        <File Name="GamConfig.txt" KeyPath="yes" />
      </Component>
      <Component Id="GamContacts_txt" Guid="f1ece4ca-95a4-419b-aa26-35c1ae8935ef">
        <File Name="GamContacts.txt" KeyPath="yes" />
      </Component>
      <Component Id="GamDataSelection_txt" Guid="3e170320-35f8-4daf-b546-0b8368774175">
        <File Name="GamDataSelection.txt" KeyPath="yes" />
      </Component>
      <Component Id="GamSites_txt" Guid="3022e387-aa76-4533-bf4d-3784aaa44cda">
        <File Name="GamSites.txt" KeyPath="yes" />
      </Component>
      <Component Id="GamUpdate_txt" Guid="1b7cdd48-0fff-4943-a219-102fcd14c755">
        <File Name="GamUpdate.txt" KeyPath="yes" />
      </Component>
      <Component Id="cacerts_pem" Guid="61fe2b2d-1646-4bed-b844-193965e97727">
        <File Name="cacerts.pem" KeyPath="yes" />
      </Component>
    </ComponentGroup>
  </Fragment>

  <Fragment>
    <InstallUISequence>
      <ExecuteAction />
      <Show Dialog="WelcomeDlg" Before="ProgressDlg" />
    </InstallUISequence>
    <CustomAction Id="setup_gam" ExeCommand="[INSTALLFOLDER]gam-setup.bat" Directory="INSTALLFOLDER" Execute="commit" Impersonate="yes" Return="asyncWait"/>
    <InstallExecuteSequence>
     <Custom Action="setup_gam" After="InstallFiles" >NOT Installed AND NOT UPGRADINGPRODUCTCODE AND NOT WIX_UPGRADE_DETECTED</Custom>
    </InstallExecuteSequence>
  </Fragment>
</Wix>
